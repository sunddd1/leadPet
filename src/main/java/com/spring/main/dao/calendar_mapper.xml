<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
	"-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd"
 >
 
 <!-- 누가 이 XML을 사용할까?(mybatis) / 누구와 연결을? (해당 DAO) -->
 <mapper namespace="com.spring.main.dao.CalendarDAO">
	<select id="scheduler" resultType="scheduler">
		SELECT * FROM scheduler WHERE d_day BETWEEN #{param1} AND #{param2}
	</select>
	
	<select id="vaccin_scheduler" resultType="vaccin_scheduler">
		SELECT vs.d_day, vs.vacc_sche_idx,vs.vac_idx,v.vacc_name , p.name  FROM 
		pet p,vaccin_scheduler vs,pet_vaccin pv,vaccin v 
		WHERE p.pet_idx=pv.pet_idx AND vs.vac_idx=pv.vac_idx AND v.vacc_idx=pv.vacc_idx AND
		 d_day BETWEEN #{param1} AND #{param2} ORDER BY vs.vacc_sche_idx DESC
	</select>
	
	<select id="vaccinList"  resultType="vaccin">
		SELECT pv.vac_idx , p.pet_idx, p.name , v.vacc_name, pv.expected_date FROM pet_vaccin  pv , pet p ,vaccin v  
		WHERE p.pet_idx=pv.pet_idx AND v.vacc_idx=pv.vacc_idx AND p.pet_idx in 
		(SELECT pet_idx FROM pet WHERE id ='testId') AND pv.expected_date BETWEEN #{param1} AND #{param2} AND pv.added='N'  ORDER BY pv.vac_idx DESC
	</select>
	
	<select id="calendardetail" resultType="scheduler">
	
		SELECT * FROM scheduler WHERE sche_idx=#{param1}
	
	</select>
	
	<select id="vaccinDetail" resultType="vaccin">
		SELECT v.content,v.vacc_name,v.cycle, v.vacc_idx ,pv.expected_date,pv.vac_idx 
		FROM pet_vaccin pv, vaccin v 
		WHERE pv.vacc_idx=v.vacc_idx AND pv.vac_idx=#{param1}
	</select>
	
 	<insert id="regVaccin">
		INSERT INTO vaccin_scheduler (vacc_sche_idx,vac_idx,d_day,id)
		VALUES (vacc_sche_idx_seq.NEXTVAL,#{param1},#{param2},#{param3} )
	</insert> 
	
	<select id="cycle" resultType="long">
		SELECT cycle FROM vaccin WHERE vacc_idx = #{param1}
	</select>
	
 	<update id="upDateDay">
		UPDATE pet_vaccin SET added='Y', expected_date=#{param3} 
		WHERE vac_idx = #{param1}
	</update> 
	

 </mapper>